## Преступление в тестовой сети {#sec:crime_on_testnet}

_Эта фантастическая антиутопия, объясняющая основы анализа блокчейна, изначально была опубликована отдельным постом в блоге._^[<https://sprovoost.nl/2018/12/28/a-crime-on-testnet-6d95ede8da03/>]
\

Теплым летним днем так хочется фраппучино. К сожалению, наркотики, такие как кофеин, сахар и какао, несколько десятилетий назад были объявлены незаконными. Это произошло, потому что молодых безработных выпускников колледжей часто задевали шумные богатые люди, употребляющие кофеин. Сахар вызывал ожирение, а также рак. Какао слишком явно ассоциировалось с угнетением. В наши дни мало кто помнит, как именно, им просто показывают фотографии кокаиновых наркоманов и говорят, что какао — это наркотик, начав с которого, подсядешь и на кокаин.

К счастью, я знаю парня, и он берет 0.002,000 биткоина. Я запускаю свой кошелек Bitcoin Core, потому что мне нравится ретро-стиль. Он даже не использует запятую после десятичного разделителя, к чему мы все привыкли в эпоху гипердефляции. Некоторые люди просто скажут 2000 биткоинов, но не говорите так рядом с церковью Core!

\newpage
Сначала мне нужно купить немножко биткоинов. Биткоин в Европе это примерно как оружие в США. Одним он нравится, другим нет, но он совершенно законен. Поэтому я захожу на bitonic.nl, чтобы купить немного больше, чем мне нужно:

![](appendix/buy.png){ width=40% }

Я плачу с помощью iDEAL, который используется для всех онлайн-покупок (в фиатных валютах). Для отправки им нужен биткоин-адрес, который я получаю из своего кошелька Bitcoin Core:

![](appendix/core-2.png){ width=100% }

\newpage
Нажимаю в нем "Запросить платеж" и получаю адрес:

![[tb1q9jdtpsqxaqd8am70a7g67xn05y9x6dzremuydk](https://blockstream.info/testnet/address/tb1q9jdtpsqxaqd8am70a7g67xn05y9x6dzremuydk)](appendix/core-3.png){ width=30% }

Затем я копирую адрес в форму Bitonic в разделе «Ваш биткоин-адрес», игнорирую все предупреждения, которые дает мое банковское приложение, и завершаю платеж в размере 10 евро. Несколько мгновений спустя Bitcoin Core сообщает мне, что я получил 0.003,247,40 BTC на адрес, который я пометил как «Купить биткойн» и который я передал Bitonic (tb1q9jdtps…):

![](appendix/core-4.png){ width=100% }

Пока я жду подтверждения транзакции в блокчейне, я подхожу к тому парню (я буду называть его, скажем, Дмитрием, хотя это и расизм). Он открывает свой кошелек и дает мне адрес (tb1qnm…), который я ввожу в свой кошелек, чтобы отправить ему 0,0002,000,-- BTC.

\newpage

![](appendix/core-5.png){ width=100% }

Дмитрий знает, где я живу, поэтому не ждет подтверждения и просто дает мне фрап. Мы могли бы использовать лайтнинг, чтобы платеж прошел мгновенно, не дожидаясь подтверждения. Лайтнинг также не оставляет соответствующих следов в блокчейне, поэтому он мог бы предотвратить грядущую боль. Но мы этого не сделали.

Итак, теперь мой кошелек выглядит так, и на этом история для меня должна закончиться:

![](appendix/core-6.png){ width=100% }

\newpage

Дмитрий тем временем продает несколько фрапов разным покупателям, присваивая каждому уникальный адрес. Их кошельки будут выглядеть точно так же, как мои. В итоге кошелек Дмитрия выглядит так:

![](appendix/core-7.png){ width=100% }

Дмитрий хочет купить немного алкоголя, единственного наркотика, который все еще легален, несмотря на насилие, разрушенные семьи, разрушенные карьеры, преступность, болезни и массовые дорожно-транспортные происшествия, которые он вызвал, особенно после того, как были запрещены автомобили с искусственным интеллектом. Отчасти это произошло потому, что автомобили с искусственным интеллектом обогатили крупные корпорации, сдававшие их в аренду беднякам, которые раньше не могли позволить себе машину, но что действительно сломало спину верблюду, так это игиловские хакеры, взломавшие автопилоты и убившие 15 миллионов человек, едущих на работу.

Алкоголь продается только в супермаркетах, и в целях контроля за здоровьем населения покупать продукты настоятельно рекомендуется с помощью банковской карты. Это дает страховым компаниям точное представление о том, сколько калорий потребляете вы и ваша семья, а муниципальные медицинские работники используют эти данные, чтобы заранее посадить проблемных людей на диету. Активисты по защите конфиденциальности, как обычно, кричали "волки!", но эта практика никогда не вызывала никаких реальных проблем, а статистика здравоохранения говорит сама за себя. Было предложение разрешить в супермаркетах биткоиновые платежи путем сканирования паспорта, как в случае с наличными, но это конфликтовало с регламентом по защите персональных данных.

Почему Дмитрий просто не использует Bitonic для продажи своих монет? Ну, потому что у него есть судимость за продажу кофеина, а людям с судимостью запрещено покупать и продавать биткоины. А теперь представляем вам Киса, главного героя нашей истории. Кис — биткоин-трейдер, и он предлагает купить монеты Дмитрия на 10% дешевле их рыночной цены.

Итак, у Дмитрия теперь пустой кошелек, а Кис получил на свой кошелек чуть меньше 0.006 BTC (майнеры берут небольшую комиссию за обработку каждой транзакции):

![](appendix/core-8.png){ width=100% }

У Киса проблема. Он под наблюдением. Вскоре после сделки с Дмитрием полицейский под прикрытием предлагает продать 0,001 BTC. Кис предлагает оплату наличными на 10% дешевле рыночной цены и называет адрес tb1q3nf… Теперь его кошелек выглядит так:

![](appendix/core-9.png){ width=100% }

Кис не знает о том, что Дмитрий, продавая кофе в тот день, попал на камеру, и его арестовали на выходе из супермаркета. Его (пустой) биткоин-кошелек был конфискован, вместе с его теперь уже пустым фиатным кошельком и тем, что осталось в бутылке со спиртным. Как вы можете видеть выше, кошелек содержал транзакции и заметки. Время каждой транзакции совпадало с записью камеры, сумма соответствовала известной цене фрапса, а в примечаниях даже говорилось, что это фрапс. В кошельке также указан адрес назначения, куда Дмитрий отправил BTC (tb1qja…), который, по подозрению полиции, принадлежат Кису. Они подозревают, что Дмитрий продал монеты в обмен на наличные деньги, хотя сами наличные искать уже слишком поздно.

Кис еще не арестован, поэтому никто не знает, какие у него биткоин-адреса. К нему подходит повернутый на конфиденциальности активист, который хочет купить биткоины и не хочет слежки, возникающей при покупке монет онлайн с помощью iDeal. У него нет никакого намерения совершить какое-либо преступление, даже уклоняться от уплаты налогов. Он снимает часть своих законно заработанных тяжким трудом денег в банкомате. Затем он терпит долгий телефонный допрос со стороны своего банка, который всегда следует за подобными операциями. Затем он договаривается о хорошей комиссии в размере 3% выше рыночной. Кис отправляет ему монеты, поэтому кошелек Киса теперь выглядит так (2 покупки, 1 продажа):

![](appendix/core-10.png){ width=100% }

Тем временем наш полицейский, назовем его Дональд, заходит в интернет и ищет адрес, по которому он торговал с Кисом (tb1q3nf…). Bitcoin Core не поддерживает поиск адресов, потому что он плохо масштабируется, и, как выразился Владимир ван дер Лаан, «Bitcoin Core не предназначен для использования в качестве платформы для анализа блокчейна». Его любимый обозреватель блоков blockchain.com не поддерживает поиск адресов bech32, поэтому он обращается к конкуренту.

![](appendix/explorer.png){ width=100% }

Следующая иллюстрация описывает транзакции, связанные с адресом tb1q3nf…. Дональд подозревает, что этот адрес принадлежит Кису, потому что это адрес, который Кис дал ему для отправки монет.

Читая снизу вверх, в 13:51:15 офицер Дональд видит, что монеты с его собственного адреса (tb1qjy4…, обведено синим) идут по этому адресу (tb1q3nf…, обведено желтым, адрес, который ему дал Кис). Он также видит, что монеты возвращаются в его собственный кошелек в качестве сдачи (tb1q80q…, также обведено синим).

Вверху, в 14:01:03, он видит монеты Киса (все тот же адрес: tb1q3nf…, на этот раз обведен синим) в сочетании с монетами из конфискованного ранее кошелька Дмитрия (обведено красным). Монеты отправляются на какой-то неизвестный адрес (который, как мы знаем, принадлежит адепту конфиденциальности).

Это действие по объединению монет имеет решающее значение. Если бы Кис продавал монеты полицейскому под прикрытием отдельно от монет Дмитрия, между ними не было бы видимой связи.

Дональд берет статью, написанную давным-давно в 2013 году, под названием «Пригоршня биткоинов», в которой говорится следующее:^[<https://cseweb.ucsd.edu/~smeiklejohn/files/imc13.pdf>]

> ЭВРИСТИКА 1. Если два (или более) адреса являются входными данными для одной и той же транзакции, они контролируются одним и тем же пользователем; т. е. для любой транзакции t все входы E(t) контролируются одним и тем же пользователем.

Ну, это выглядит действительно научно! Неважно, что эвристика — это всего лишь эвристика, а не факт. В своем отчете он также решает опустить такие предложения, как следующие:

> Наконец, мы подчеркиваем, что наше определение управления адресом сильно отличается от определения владения учетной записью; например, мы считаем, что сервис кастодиальных кошельков, такой как Instawallet, является контроллером каждого из адресов, которые он создает, даже если средства на этих адресах принадлежат большому количеству различных пользователей.

В нашем случае, конечно, мы знаем, что эвристика была правильной, потому что мы видели бумажник Киса. Но Кис использовал шифрование, и его кошелек в безопасности. Он использует свое право хранить молчание. Не всегда разумный выбор, когда вы сталкиваетесь с обвинениями в отмывании денег, потому что презумпция невиновности и право хранить молчание тут более или менее выброшены в окно.

Теперь Кису предъявлено обвинение в отмывании 0,007 биткоина, а именно суммы от Дональда плюс суммы от Дмитрия. Если бы «кластер», который формирует его кошелек, включал больше транзакций, то они также были бы добавлены к общей сумме. Поскольку Дональд заплатил комиссию в размере 10%, автоматически предполагается, что Кис получил эти 10%, а поскольку это больше, чем сборы Bitonic, то, по мнению прокурора, это должно дать Кису достаточные основания подозревать незаконное происхождение денег, и, таким образом, он должен был в курсе их незаконности.

Таким образом, бремя доказывания перекладывается на Киса, и ему необходимо дать объяснение, которое не является априори невероятным, происхождения 0,006. Он этого не делает, поэтому его судят и отправляют в тюрьму.

Это самый простой случай, который я могу придумать, чтобы продемонстрировать, как работает кластерный анализ и как он на самом деле используется. На практике случаи гораздо сложнее, и анализ не проводится так тщательно, как я описал выше. Вместо этого полиция полагается на такие компании, как Chainalysis, чтобы выяснить, какие адреса кому принадлежат, а те составляют причудливые диаграммы, которые показывают, виновен ли кто-то.

Никто не знает, какие источники данных используют такие компании, как Chainalysis, или как они находят кластеры; они держат свои алгоритмы в секрете. Есть бесчисленное множество путей, которыми подобный анализ может зайти не туда, так что все довольно быстро превращается в карго-культ^[<https://en.wikipedia.org/wiki/Cargo_cult_science>] и суды над ведьмами, в результате чего могут быть вынесены ложные приговоры. Удачи вам в поисках защитника, который понимает подобные тонкости, и еще больше удачи, чтобы объяснить эту логику в суде (после того, как вы провели несколько месяцев в тюрьме без возможности выйти под залог).
