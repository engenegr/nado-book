## Еще несколько эпизодов {#sec:more_eps}

Не все эпизоды подкаста *Биткоин, разъяснения* вошли в эту книгу. Вот некоторые другие эпизоды, которые вы можете послушать. Приведенные ниже описания в основном основаны на заметках к шоу, написанных соведущим Аароном ван Вирдумом.

### Основы

#### Что такое xpub?

\EpisodeQR{7}

В этом эпизоде мы объясняем, что такое расширенный открытый ключ (xpub) и как он используется биткоин-кошельками. Расширенные ключи были впервые представлены в BIP 32 для создания так называемых иерархических детерминированных кошельков.^[<https://en.bitcoin.it/wiki/BIP_0032>] Такие кошельки создают новый адрес каждый раз, когда пользователь хочет получить монеты. В отличие от более ранних кошельков, которые требовали хранить в безопасном месте каждый новый адрес, этим новым кошелькам требуется только одна резервная копия, обычно в виде мнемонической фразы из 12-24 слов. ^ [BIP 39 <https://en.bitcoin.it/wiki /BIP_0039>]

<!-- Сноска BIP 39 намеренно несовместима с BIP 32, поэтому QR-коды не имеют прямого соседства. -->

#### Replace-By-Fee (RBF)

\EpisodeQR{26}

В этом выпуске мы рассказываем о замене комиссии (Replace-By-Fee или RBF). RBF — это трюк, который позволяет заменить неподтвержденные транзакции конфликтующими транзакциями, которые включают более высокую комиссию.

\noindent
С помощью RBF пользователи могут существенно увеличить комиссию за транзакцию, чтобы стимулировать майнеров включать ее в блок. Мы подробно описываем три преимущества RBF: возможность «ускорить» транзакцию (1), что, в свою очередь, может привести к более эффективному рынку комиссий за пространство в блоке (2), и потенциал более эффективного использования пространства в блоках за счет обновления транзакций на те, что включают больше получателей (3).

Основной недостаток RBF состоит в том, что он немного упрощает двойную трату неподтвержденных транзакций, что также было причиной споров о двойных тратах, которые доминировали в заголовках в начале 2021 года.^[<https://insights.deribit .com/market-research/was-there-a-bitcoin-double-spend-on-jan-20-2021/>] Мы обсуждаем некоторые решения для снижения этого риска, в том числе «opt-in RBF», который реализован в настоящее время в Bitcoin Core.

Наконец, мы подробно объясняем, как работает opt-in RBF и какие условия должны быть выполнены, прежде чем транзакция будет считаться заменяемой. В процессе мы отмечаем некоторые сложности, связанные с этой версией RBF — например, в контексте сети Lightning.

\newpage
#### Signet

\EpisodeQR{10}

Signet — это новый тип тестовой сети для Биткоина. В этом выпуске мы обсуждаем первоначальную версию блокчейна для публичного тестирования (тестнет) и обрисовываем ее проблемы. Затем мы объясняем, почему сигнеты по своей природе похожи на тестнет, но более надежны и могут централизованно управляться. Сигнет — их может быть больше одной — обеспечивается путем добавления дополнительного требования к подписи для проверки блокировки (отсюда и «sig»). ^[Можете прочитать подробнее о сигнетах или попробовать поработать в них сами: <https://en.bitcoin.it/wiki/Signet>]

#### Мемпулы, Ребенок Платит за Родителя и Ретрансляция пакетов

\EpisodeQR{19}

В этом эпизоде мы обсуждаем пулы памяти Биткоина (мемпулы), опцию Ребенок Платит за Родителя (Child Pay For Parent или CPFP) и ретрансляцию пакетов.

\noindent
Ретрансляция пакетов — это проект, над которым Глория Чжао работает в рамках своей стипендии Brink.^[<https://brink.dev/programs>]. Это сделало бы сеть Lightning более надежной (помимо других преимуществ). Мемпулы — это наборы неподтвержденных транзакций, хранящиеся в узлах. Затем узлы пересылают эти неподтвержденные транзакции из своего мемпула другим узлам. Майнеры обычно выбирают те транзакции из своего мемпула, которые включают самые высокие комиссии, и включают их в добываемые ими блоки.

Однако мемпулы могут переполняться, и в этот момент транзакции с наименьшей комиссией удаляются. На самом деле это проблема в контексте CPFP, который представляет собой трюк, позволяющий пользователям ускорить транзакции с низкой комиссией, тратя монеты от этих транзакций на новую транзакцию с высокой комиссией для компенсации.^[<https://bitcoinops .org/en/topics/cpfp/>] Подобные трюки могут быть особенно важны в контексте чувствительных ко времени протоколов, таких как сеть Lightning.

В этом эпизоде мы подробно рассказываем о том, как ретранслятор пакетов может обеспечить CPFP — даже в случаях, когда транзакции с низкой комиссией удаляются из мемпулов — путем объединения транзакций в пакеты. Мы также исследуем, почему это легче сказать, чем сделать.

#### Смерть мемпулу, да здравствует мемпул!

\EpisodeQR{50}

Здесь мы обсуждаем недавнюю ветку в списке рассылки разработчиков Биткоина под названием «Смерть мемпулу, да здравствует мемпул».^[<https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-October/019572.html>]

\noindent
В треде инженер Blockstream Лиза «niftynei» Нейгут предлагает избавиться от пула памяти (мемпула), представляющего собой набор неподтвержденных транзакций, который биткоин-узлы используют для обмена транзакциями по сети, а биткоин-майнеры для создания новых блоков. Она утверждает, что систему Биткоина можно значительно упростить, если вместо этого пользователи будут просто отправлять свои транзакции напрямую майнерам (или майнинг-пулам).

В эпизоде мы объясняем, как это будет работать и почему это не так просто, как может показаться. Мы обращаемся к ответам в ветке, рассматривая причины, по которым избавление от мемпула на самом деле не очень хорошее решение для такой системы, как Биткоин. Особое внимание уделяется последствиям, которые это может иметь для конфиденциальности и децентрализации майнинга. Также мы рассматриваем некоторые другие компромиссы, на которые необходимо пойти, чтобы заставить систему Биткоина работать без мемпула.

\newpage
#### Процесс предложений по улучшению Биткоина (BIP)

\EpisodeQR{39}

В этом эпизоде мы объясняем, что такое предложения по улучшению Биткоина (Bitcoin Improvement Proposals или BIP) и как работает процесс BIP. Мы обсудим, почему процесс BIP - это полезное, но необязательное соглашение в техническом сообществе Биткоина.

\noindent
Во-первых, мы объясняем, чем является BIP, а чем точно не является. Мы также объясняем, что BIP требуют только улучшения кода Биткоина, которые затрагивают другие проекты. Затем мы немного углубляемся в историю процесса BIP, отметив, что формат был представлен разработчиком Libbitcoin Амиром Тааки, а позже обновлен держателем Bitcoin Knots Люком Дашем-младшим.

Наконец, мы рассказываем, как работает сам процесс BIP, то есть как предложение может быть преобразовано в BIP и в конечном итоге реализовано в софте. Мы также кратко объясняем, как процесс BIP может быть нарушен и почему это не будет иметь большого значения.

\newpage
### Использование ресурсов

#### Компактная фильтрация на стороне клиента (Neutrino)

\EpisodeQR{25}

В этом выпуске мы обсуждаем компактную фильтрацию на стороне клиента, также известную как Neutrino. Это решение для использования Биткоина без необходимости загружать и проверять всю цепочку блоков и не жертвуя своей конфиденциальностью в пользу кого-либо, кто управляет полным узлом (и, следовательно, загружал и проверял всю цепочку блоков).

Загрузка и проверка всего блокчейна Биткоина может занять пару дней даже на стандартном ноутбуке, а на смартфонах и других компьютерах с ограниченной производительностью требуется гораздо больше времени. Вот почему многие люди предпочитают использовать легкие клиенты. Они не так безопасны, как полные биткоин-узлы, но для их работы требуется меньше вычислительных ресурсов.

Некоторые типы легких клиентов — клиенты с упрощенной проверкой платежей (SPV) — в сущности, запрашивают узлы в сети Биткоина о конкретных биткоин-адресах, которые им интересны, чтобы проверить, сколько биткоинов они владеют. Это плохо для конфиденциальности, поскольку оператор полного узла узнает, какие адреса принадлежат пользователю SPV.

Компактная фильтрация на стороне клиента — это новое решение для достижения целей, аналогичных SPV, но без потери конфиденциальности. Вкратце, это работает за счет того, что операторы полных узлов создают криптографическую структуру данных, которая сообщает пользователю легкого клиента, мог ли блок содержать активность, относящуюся к запрошенным адресам, поэтому пользователь может отслеживать свои средства, загружая только небольшое подмножество всех блоков Биткоина.

Мы объясняем более детально, как это работает, и обсуждаем некоторые компромиссы этого решения.

\newpage
#### Компактные блоки

\EpisodeQR{51}

Мы объясняем, как одноранговая сеть Биткоина становится более эффективной и быстрой с помощью компактных блоков.^[<https://bitcoincore.org/en/2016/06/07/compact-blocks-faq/>]

\noindent
Компактные блоки — это, как следует из названия, компактные версии блоков Биткоина, которые использовались узлами Bitcoin Core, начиная с версии 0.13. Компактные блоки содержат минимальное количество данных, необходимых узлам Биткоина для восстановления целых блоков. В частности, компактные блоки исключают большинство данных транзакций и вместо этого содержат короткие идентификаторы транзакций. Биткоин-узлы могут использовать эти короткие идентификаторы, чтобы выяснить, какие транзакции из их мемпулов следует включить в блоки.

Мы объясняем, как и почему компактные блоки приносят пользу сети Биткоина и, в частности, как они помогают противостоять централизации майнинга. Мы также рассматриваем некоторые крайние случаи, которые могут возникнуть в результате использования компактных блоков, например возможность того, что разные валидные транзакции могут иметь одинаковый идентификатор, и поясняем, как узлы Биткоина обрабатывают такие случаи.

Вы также можете посмотреть презентацию Грега Максвелла о достижениях в распространении блоков или прочитать расшифровку.^[<https://btctranscripts.com/greg-maxwell/gmaxwell-2017-11-27-advances-in-block-propagation/>]

\newpage
#### Erlay

\EpisodeQR{34}

В этом эпизоде мы обсуждаем протокол Erlay. Erlay — это предложение уменьшить пропускную способность, необходимую для работы узла Биткоина. Он был предложен и разработан исследователями Университета Британской Колумбии Глебом Науменко, Александрой Федоровой и Иваном Бесчастных; инженером Blockstream Питером Вуилле; и независимым участником Bitcoin Core Грегори Максвеллом.

Биткоин-узлы используют полосу пропускания для приема и передачи как данных блоков, так и данных транзакций. Уменьшение пропускной способности, необходимой узлу для всего этого, удешевит работу узла. Или, как вариант, это позволило бы узлам подключаться к большему количеству одноранговых узлов без увеличения использования полосы пропускания.

Мы объясняем, что Erlay использует согласование наборов, чтобы уменьшить количество узлов данных, необходимых для обмена транзакциями. В частности, Erlay использует математический прием под названием Minisketch^[<https://github.com/sipa/minisketch>]. Это решение основано на уже существующих математических формулах, используемых в биометрических технологиях.

Мы также описываем, как этот трюк применяется в контексте Биткоина, чтобы позволить различным узлам синхронизировать свои мемпулы, которые представляют собой наборы транзакций, полученные ими в ожидании нового блока - или, в случае майнера, чтобы включить их в новый блок.

\newpage
### Атаки

#### Атака искажения времени


\EpisodeQR{5}

В этом эпизоде мы объясняем «атаку искажения времени» на Биткоин. Потенциальное исправление против этой атаки включено в софт-форк Great Consensus Cleanup, предложенный Мэттом Коралло,^[<https://github.com/TheBlueMatt/bips/blob/cleanup-softfork/bip-XXXX.mediawiki>], однако ко времени написания в его разработе не наблюдалось особого прогрессса.
\

#### Атаки PSBT и RBF

\EpisodeQR{1}

В этом эпизоде мы разбираем и объясняем частично подписанные биткойн-транзакции (PSBT) и транзакции с заменой комиссии (RBF), а также некоторые действительно хитрые атаки, которые были обнаружены.^[Вектор атаки PSBT <https://blog.trezor.io/latest-firmware-updates-correct-possible-segwit-transaction-vulnerability-266df0d2860> и вектор атаки RBF <https://zengo.com/bigspender-double-spend-vulnerability-in-bitcoin-wallets/>]

\noindent
PSBT — это формат данных, который позволяет кошелькам и другим инструментам обмениваться информацией о биткоин-транзакциях и подписях, необходимых для ее завершения.^[<https://bitcoinops.org/en/topics/psbt/>]

\newpage
#### Цензура майнинг-пулов

\EpisodeQR{37}

В этом эпизоде мы обсуждаем появление Mara Pool, американского пула по майнигу биткойнов, который — на момент записи этого эпизода — утверждал, что полностью соответствует законодательству США. Это означает, что он применяет проверки по борьбе с отмыванием денег (AML) и придерживается санкционного списка Управления по контролю за иностранными активами (OFAC). Хотя детали не были обнародованы, это, по-видимому, означает, что данный пул не будет включать транзакции в блоки, если эти транзакции отправляют монеты на (или с) включенные в черный список OFAC биткоин-адреса.

Через некоторое время после записи эпизода пул изменил курс и объявил, что не будет подвергать транзакции цензуре.

В этом эпизоде мы обсуждаем перспективы цензуры майнинга, что это будет означать для Биткоина и что с этим можно сделать. Мы рассматриваем под более широким углом, на что было бы похоже, если бы такая практика была принята многими. Мы рассматриваем, чего могут добиться пулы майнинга в своей политике цензуры, если они когда-либо приблизятся к контролю над большей частью хэш-мощности, и что потенциально смогут сделать пользователи Биткоина в таком сценарии (если вообще что-либо смогут).

\newpage
### Кошельки

#### Интеграция аппаратных кошельков в Bitcoin Core

\EpisodeQR{30}

Мы обсуждаем интеграцию аппаратных кошельков в Bitcoin Core - это один из текущих проектов, в которых Щорс регулярно участвует.

\noindent
Аппаратные кошельки — популярное решение для хранения закрытых ключей в автономном режиме, чтобы минимизировать риск получения хакерами доступа к соответствующим монетам. Они используются для подписи транзакций в сочетании с обычными программными кошельками  таким образом, что закрытые ключи никогда не покидают устройство.

#### Безопасность аппаратных кошельков и кошелек Jade

\EpisodeQR{43}

К соведущему Аарону присоединяются Лоуренс Наум из Blockstream, один из разработчиков аппаратного кошелька Jade, и Бен Кауфман, один из разработчиков Spectre Desktop — программного инструментария для аппаратных кошельков.

\noindent
Они рассказывают о том, что такое аппаратные кошельки, и обсуждают компромиссы при разработке различных моделей, уделяя особое внимание устройствам Trezor, Ledger и Coldcard. В этом свете Лоуренс и Бен объясняют, что такое безопасные элементы и безопасные чипы, и почему некоторые аппаратные кошельки в большей мере, чем другие, предпочитают использовать такие чипы.

Затем Лоуренс объясняет, на какие компромиссы идет кошелек Jade. Он также подробно описывает, какой дополнительный серверный слой безопасности используется для защиты кошелька Jade, и кратко описывает некоторые дополнительные различия в дизайне аппаратных кошельков, например те, которые ориентированы на удобство использования.

Наконец, они обсуждают, переоценены ли аппаратные кошельки, или с таким же успехом для хранения биткоинов можно было бы использовать отдельный смартфон.

#### Bitcoin Beach

\EpisodeQR{42}

Соведущий Аарон беседует с разработчиком Bitcoin Beach Wallet Николасом Берти в Эль-Зонте, Сальвадор, который получил название Bitcoin Beach, чтобы обсудить Bitcoin Beach Wallet, биткоин-кошелек с поддержкой лайтнинга, специально разработанный для использования в небольшом прибрежном городке Центральной Америки, который часто посещают серферы, а теперь и биткоинеры.

Они обсуждают плюсы и минусы кастодиальных и некастодиальных лайтнинг-кошельков, а Николас объясняет, почему он решил сделать Bitcoin Beach Wallet кошельком с общим хранилищем, и что это означает.

Далее они обсуждают некоторые дизайнерские решения и компромиссы, которые потребовались для кошелька Bitcoin Beach. Это, например, внутренние переводы между пользователями кошелька Bitcoin Beach и платежи без инвойсов из других кошельков Lightning. Николас также размышляет о потенциальной системе учетных записей пользователей с несколькими кошельками, чтобы и дальше увеличивать удобство использования лайтнинга для пользователей.

Наконец, обсуждаются некоторые тонкие несовместимости между разными лайтнинг-кошельками, которые используют разные методы маршрутизации платежей, компромиссы между удобством и конфиденциальностью в сообществе, подобном Эль Зонте, и многое другое.

#### Chivo

\EpisodeQR{46}

В этом выпуске мы обсуждаем приложение Chivo, биткоин-кошелек и платежный терминал, предоставляемый правительством Сальвадора. Приложение Chivo - это софт с закрытым исходным кодом. Вместо анализа исходного кода и дизайна приложения нам пришлось полагаться на личный опыт работы с кошельком и платежным терминалом.

Выпуск начинается с некоторой общей информации о кошельке Chivo, например, почему он был разработан и кто его разработал (насколько об этом известно). Мы обсуждаем опыт Аарона в использовании кошелька и размышляем, что это означает в плане дизайна. После этого мы обсуждаем дизайн платежного терминала, включенного в приложение, а также кратко касаемся банкоматов Chivo, развернутых по всей стране. Наконец, мы обсуждаем разницу в философии между дизайном приложения Chivo и культурой бесплатного и открытого программного обеспечения Биткоина.

#### Платежные пулы

\EpisodeQR{6}

В этом выпуске мы объясняем, что такое платежные пулы и зачем им нужен Taproot. Мы обсуждаем, как на практике работает объединения UTXO, и то, как платежные пулы могут работать с сетью Лайтнинг.

\noindent
Для получения дополнительной информации см. статью Аарона.^[<https://bitcoinmagazine.com/articles/building-on-taproot-payment-pools-could-be-bitcoins-next-layer-two-protocol>]

#### Учетные записи Easypaysy

\EpisodeQR{11}

Мы обсуждаем easypaysy, предложенную Хосе Фемениасом - систему учетных записей для Биткоина, на блокчейне Биткоина. Одна из функций, которую она поддерживает - скрытые метки адресов. Мы обсудим несколько вариантов использования. Наконец, мы объясняем, что такое безотказность.

Аарон также написал статью об easypaysy для журнала Bitcoin Magazine..^[<https://bitcoinmagazine.com/articles/bitcoin-need-accounts-one-developer-thinks-figured>]

\newpage
### Лайтнинг

О сети Лайтнинг можно написать целую книгу. Многие и впрямь это сделали, см., например. _Освоение сети Лайтнинг, протокола второго уровня над блокчейном для мгновенных платежей в биткоинах_ Андреас М. Антонопулос и Олаолува Осунтокун (он же Roasbeef).^[<https://www.oreilly.com/library/view/mastering-the-lightning/ 9781492054856/>]


В этой книге не рассматривается Lightning, но есть несколько выпусков подскаста _Bitcoin, Explained_, где это делается.

#### Основы

\EpisodeQR{22}

Тут мы обсуждаем основы сети Лайтнинг, протокола второго уровня над Биткоином, для более дешевых, быстрых и, возможно, более конфиденциальных транзакций. Мы объясняем, что сеть Лайтнинг работает как способ масштабирования, поскольку позволяет пользователям совершать транзакции вне блокчейна через двунаправленные платежные каналы: два пользователя могут платить друг другу произвольное количество раз без записи этих транзакций в блокчейне. Далее мы объясняем, как в протоколе Лайтнинг обеспечивается безопасность этих транзакций вне сети, то есть как каждый из участников в любой момент может гарантированно получить свои соответствующие средства из платежного канала.

Затем мы объясняем, как двунаправленные платежные каналы могут быть связаны в сеть, чтобы расширить потенциал транзакций вне блокчейна, и обеспечить любому пользователю Лайтнинга возможность заплатить любому другому пользователю Лайтнинга, даже если они не настроили платежный канал конкретно между ними двумя.

Наконец, мы слегка касаемся некоторых проблем, связанных с сетью Лайтнинг, в первую очередь требований к тому, чтобы платежные каналы имели достаточную ликвидность.

\newpage
#### Ошибка RBF в Bitcoin Core

\EpisodeQR{38}

Мы обсуждаем CVE-2021-31876, ошибку в коде Bitcoin Core, которая влияет на дочерние транзакции Replace-By-Fee (RBF).^[<https://cve.mitre.org/cgi-bin/cvename.cgi?name =CVE-2021-31876>] В системе "Распространенные уязвимости и риски" (Common Vulnerabilities and Exposures, CVE) предлагается обзор общеизвестных программных ошибок. Антуан Риар обнаружил и раскрыл новую ошибку в коде Bitcoin Core, и она была добавлена в обзор CVE.

Мы объясняем, что ошибка влияет на то, как логика RBF обрабатывается программным обеспечением Bitcoin Core. Когда одна неподтвержденная транзакция имеет флаг RBF (это означает, что ее следует считать заменяемой, если по сети транслируется конфликтующая транзакция с более высокой комиссией), любая последующая транзакция, которая тратит монеты из исходной транзакции, также должна считаться заменяемой — даже если вторая транзакция сама по себе не имеет флага RBF. Однако программное обеспечение Bitcoin Core этого не делает, а это означает, что вторая транзакция по факту не будет считаться заменяемой.

Это довольно невинная ошибка; в большинстве случаев вторая транзакция все равно будет в конце концов подтверждена, хотя есть и другие решения для ускорения подтверждения, если включенная комиссия слишком низкая. Но в очень специфических случаях, таких как некоторые резервные механизмы безопасности в сети Лайтнинг, ошибка может вызвать осложнения. Мы пытаемся объяснить, как мог бы выглядеть такой сценарий, но в итоге совершенно запутываемся.

\newpage
#### Маршрутизация

\EpisodeQR{41}

К нам присоединился лайтнинг-разработчик Джуст Джагер, чтобы обсудить все, что касается сетевой маршрутизации Лайтнинга.


\noindent
Сеть Лайтнинг состоит из платежных каналов. Каждый платежный канал существует между двумя пользователями Лайтнинга. Но даже если у двух пользователей нет канала оплаты между собой напрямую, они могут платить друг другу через одного или нескольких других пользователей Лайтнинга, которые в этом случае перенаправляют платеж от отправителя к получателю.

Проблема заключается в том, что им необходимо найти в сети способ оплаты, который позволяет средствам перемещаться от отправителя к получателю — в идеале, самый дешевый, быстрый и надежный доступный путь оплаты.

Джуст объясняет, как лайтнинг-узлы в настоящее время создают карту сети Лайтнинга и какая информация обо всех (общедоступных) платежных каналах включена в эту карту. Затем он описывает, на основании чего лайтнинг-узлы рассчитывают лучший путь по сети, чтобы достичь получателя платежа, и как производительность этого маршрута влияет на будущие вычисления при поиске пути.

Наконец, мы обсудим некоторые (потенциальные) оптимизации для улучшения сетевой маршрутизации Лайтнинга, такие как схемы ребалансировки и trampoline-платежи.

\newpage
#### Оптимально надежные и дешевые платежные потоки в сети Лайтнинг

\EpisodeQR{47}

В этом выпуске мы берем интервью у другого эксперта по маршрутизации в Лайтнинге, Рене Пикхардта. Мы обсуждаем его статью _Оптимально надежные и дешевые платежные потоки в сети Лайтнинг_.^[<https://arxiv.org/abs/2107.05322>] Цитируя аннотацию:

\
> Сегодня платежные маршруты в сети Лайтнинга находятся путем поиска кратчайших путей на графике комиссий. Мы совершенствуем этот подход в двух измерениях. Во-первых, мы учитываем вероятность того, что платеж действительно возможен, поскольку распределение баланса в каналах неизвестно. Во-вторых, мы используем потоки с минимальными затратами как правильное обобщение кратчайших путей ко многоэтапным платежам (multi-part payments, MPP). В частности, мы показываем, что при правдоподобных предположениях о распределении баланса мы можем найти наиболее вероятный MPP для любого заданного набора отправителей, получателей и сумм, находя (обобщенный) целочисленный поток минимальных затрат с отделимой и выпуклой функцией затрат. Для этой задачи оптимизации известны как точные алгоритмы с полиномиальным временем, так и аппроксимации. Мы представляем поэтапный алгоритм расчета потока с минимальной стоимостью для доставки больших сумм платежей через сеть Лайтнинг. Этот алгоритм работает, обновляя распределения вероятностей с помощью информации, полученной как от успешных, так и от неудачных путей на предыдущих этапах. Во всех наших экспериментах было достаточно однозначного числа этапов для доставки платежей, размер которых был близок к общему локальному балансу отправителя. Ранние эксперименты показывают, что наш подход увеличивает размер платежей, которые могут быть надежно доставлены, на несколько порядков по сравнению с текущим уровнем техники. Мы видим, что поиск самых дешевых многоэтапных платежей является NP-сложной задачей, в рамках текущей структуры комиссий, и предлагаем отказаться от базовой комиссии, чтобы сделать такой поиск линейной задачей потока минимальных затрат. Наконец, мы обсуждаем возможности максимизации вероятности при одновременном снижении платы за поток. Хотя в общем виде это также оказывается сложной задачей — даже в случае с одним путем — на практике она оказывается на удивление решаемой.

#### Eltoo и `SIGHASH_ANYPREVOUT`

Мы рассмотрели эту тему дважды, поэтому на выбор есть два выпуска. В выпуске 35 мы объясняем, что это такое, а в выпуске 48 к нам присоединяется один из авторов, разработчик c-lightning Кристиан Декер, чтобы объяснить это своими словами.

\EpisodeQR{35}

\noindent
Во-первых, мы обсудили `SIGHASH_ANYPREVOUT`, предлагаемый новый флаг sighash, который позволит использовать более чистую версию сети Лайтнинг и других протоколов второго уровня. Флаги sighash включаются в биткоин-транзакции, чтобы указать, какая часть транзакции подписана требуемыми закрытыми ключами.

Это может быть (почти) вся транзакция или отдельные ее части. Подписание только определенных частей обеспечивает некоторую гибкость в настройке транзакции даже после ее подписания, что иногда может быть полезно. Мы объясняем, что `SIGHASH_ANYPREVOUT` — это новый тип флага sighash, который будет подписывать большую часть транзакции, но не входные данные. Это означает, что входные данные можно поменять местами, если новые входные данные будут по-прежнему совместимы с подписью.

\EpisodeQR{48}

\noindent
SIGHASH_ANYPREVOUT будет особенно полезен в контексте Eltoo, предлагаемого протокола второго уровня, который позволит создать новую версию сети Лайтнинг. В настоящее время пользователям Лайтнинга из соображений безопасности необходимо хранить старые данные канала, а если они случайно передают некоторые из этих данных в неподходящее время, они могут быть сурово наказаны. Мы обсуждаем, как SIGHASH_ANYPREVOUT может покончить с этим требованием.

#### Bolt 12 — регулярные платежи и т.д.

\EpisodeQR{44}

Мы обсуждаем Основание 12 Технологии Лайтнинга (Basis of Lightning Technology 12 или BOLT 12), недавно предложенную спецификацию сети Лайтнинг для «офферов», которые представляют собой разновидность «мета-инвойсов», созданную разработчиком c-lightning Расти Расселом.

\noindent
В то время как монеты на базовом уровне Биткоина отправляются на адреса, сеть Лайтнинг использует инвойсы. В инвойсах сообщается запрошенная сумма, узел назначения и хэш секрета, который используется для маршрутизации платежей. Это работает, но имеет ряд ограничений — в частности, то, что сумма должна быть номинирована в биткоинах (в отличие от деноминированных в фиате), а также то, что инвойс может быть использован только один раз.

BOLT 12, реализованный в c-lightning, представляет собой способ, по сути, направить плательщика к узлу, на который должен идти платеж, чтобы запросить новый инвойс. Хотя оффер BOLT 12 может быть статическим и многократно используемым — он всегда относится к одному и тому же узлу — получатель платежа может генерировать новые офферы на лету по запросу, что обеспечивает гораздо большую гибкость.

Наконец, мы обсуждаем, как новые сообщения BOLT 12 передаются по сети Лайтнинг посредством обновления спецификации BOLT 7 для ретрансляции сообщений.

\newpage
### Сайдчейны и многое другое

Лайтнинг — не единственный путь масштабирования Биткоина, хотя на данный момент он разрабатывается наиболее активно. Еще один подход - это сайдчейны, и их можно при желании комбинировать с Лайтнингом.

Хотя общепринятого определения того, что такое сайдчейн, не существует, общая идея заключается в том, что вы создаете отдельный блокчейн со своими собственными правилами, который каким-то образом привязан к блокчейну Биткоина. Преимущество этого подхода, в теории, заключается в том, что только узлы, которые обслуживают конкретный сайдчейн, должны его проверить, в то время как остальная часть сети должна только убеждаться, что количество биткоинов, покидающих сайдчейн, не превышает количество поступающих в него.

Мы обсуждаем в подкасте некоторые из этих идей, часто с помощью специального соведущего из Утрехта Рубена Сомсена.

#### Драйвчейны

\EpisodeQR{23}

Драйвчейн — это сайдчейн-проект, возглавляемый Полом Шторцем.^[<https://www.drivechain.info>]

\noindent
Это должно сделать монеты сайдчейна взаимозаменяемыми с биткоинами, и, следовательно, они должны иметь равную стоимость. В некотором смысле сайдчейны позволяют пользователям «перемещать» биткоины между блокчейнами, где они подчиняются другим правилам протокола, что обеспечивает большую емкость транзакций, большую конфиденциальность и другие преимущества. Мы объясняем, что Драйвчейн состоит из двух основных инноваций.

Первая — это слепой объединенный майнинг (Blind Merged Mining, BMM), который позволяет биткоин-майнерам защищать драйвчейн с помощью существующей хеш-мощности, но без обязательной проверки всего, что происходит в сайдчейне.

Вторая — это арбитры хэшрейта (Hashrate Escrows), которые позволяют майнерам «перемещать» монеты из блокчейна Биткоина в сайдчейн и обратно.

Также мы обсуждаем некоторые преимущества и сложности Драйвчейна — в первую очередь последствия для безопасности, связанные с предоставлением майнерам возможности контролировать процесс привязки к конкетному блокчейну. Мы рассматриваем аргументы о том, почему этот процесс совместим по стимулам (что важно для безопасности) — или почему может быть несовместим.

#### Вечные Односторонние Привязки (Perpetual One-Way Pegs)

\EpisodeQR{12}

Рубен объясняет свое предложение комбинировать слепой объединенный майнинг и вечные односторонние привязки  для создания сайдчейна нового типа. Плохая новость: это не сделает вас богатым, но может помочь масштабировать Биткоин!

\noindent
Во-первых, он вводит концепцию цепи слепого слияния. Затем он объясняет варианты использования вечной односторонней привязки и того, что такое объединенный майнинг. Затем мы переходим к вечным односторонним привязкам и пытаемся ответить на вопрос: почему монета сайдчейна может хоть что-нибудь стоить?

Запись в блоге Рубена также объясняет эту концепцию.^[<https://medium.com/@RubenSomsen/21-million-bitcoins-to-rule-all-sidechains-the-perpetual-one-way-peg-96cb2f8ac302>]

#### Софтчейны

\EpisodeQR{27}

На этот раз мы обсуждаем одно из собственных предложений Рубена - софтчейны.^[<https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2020-December/018331.html>]

\noindent
Софтчейны — это тип сайдчейнов с двухсторонней привязкой, в которых используется новый тип механизма консенсуса: доказательства мошенничества с proof-of-work (или, как предпочитает их называть Сьорс, индикаторы мошенничества с proof-of-work). Используя этот механизм консенсуса, пользователи не проверяют содержимое каждого блока, а только проверяют заголовок proof-of-work, как это делают клиенты с упрощенной проверкой платежей (Simplified Payment Verification, SPV). Но, используя доказательства мошенничества с proof-of-work, пользователи проверяют все содержимое блоков каждый раз, когда происходит разветвление блокчейна. Это предлагает промежуточную по уровню безопасности модель безопасностью полного узла и безопасностью SPV.

Рубен объясняет, что, используя доказательство мошенничества с proof-of-work в сайдчейнах для создания Софтчейнов, полные биткоин-узлы могут проверять целые сайдчейны с минимальными затратами. Эта новая модель может быть полезна для определенных типов сайдчейнов, в первую очередь для сайдчейнов с «увеличением размера блока», которые не делают ничего особенного, но предлагают большую емкость транзакций. Мы также обсуждаем некоторые недостатки модели Софтчейн.

#### Стейтчейны

\EpisodeQR{8}

Мы обсуждаем еще одно из предложений Рубена: стейтчейны для Биткоина. Стейтчейны позволяют вам отправлять ключи вместо UTXO, плюс предлагается довольно много улучшений масштабирования и функциональности.

\noindent
Вы также можете глянуть презентацию Рубена о стейтчейнах^[<https://youtu.be/CKx6eULIC3A>] в журнале Bitcoin Magazine, а также статью Аарона в журнале Bitcoin Magazine.^[<https://bitcoinmagazine.com/articles/statechains-sending-keys-not-coins-to-scale-bitcoin-off-chain>]

\

#### RSK, федеративные сайдчейны и Powpeg

\EpisodeQR{20}

Мы обсуждаем переход RSK от федеративной модели сайдчейна к Powpeg, новому способу организации проекта.

\noindent
RSK — это разработанный IOVLabs сайдчейн Биткоина, с совместным майнингом и похожий на Эфириум. Биткоин-пользователи могут эффективно перемещать свои монеты в этот сайдчейн, который больше похож на Эфириум, и перемещать монеты обратно в блокчейн Биткоина, когда они того пожелают. Некоторые биткойн-майнеры используют свою хэш-мощность для майнинга блоков в сайдчейне и зарабатывают на этом дополнительную комиссию за транзакции.

Тонким моментом в любом сайдчейне оказывается обеспечение для пользователей возможности безопасно перемещать свои монеты между блокчейнами. Технически это осуществляется путем блокировки монет в блокчейне Биткоина и выпуска соответствующих монет в сайдчейне, и наоборот: блокировки монет в сайдчейне для разблокировки монет в блокчейне Биткоина.

До сих пор RSK делал это, привязывая монеты к адресу с мультиподписью, закрытые ключи которого контролировались группой известных компаний (это известно как модель федеративной боковой цепи). Для разблокировки монет требовалось большинство, и оно подписывало транзакцию разблокировки только в том случае, если и когда соответствующие монеты боковой цепи были заблокированы.

Теперь RSK переходит на модель Powpeg, в которой ключи к мультиподписному адресу контролируются специальными аппаратными модулями с защитой от несанкционированного доступа, которые, в свою очередь, запрограммированы на разблокировку монет в блокчейне Биткоина только в том случае, если и когда соответствующие монеты в сайдчейне заблокированы, и транзакции по блокировке этих монет имеют значительное количество подтверждений.

Мы объясняем, как именно это работает, и обсуждаем некоторые компромиссы безопасности Powpeg.

\newpage
### Прочие способы использования блокчейна

#### RGB

\EpisodeQR{33}

К нам присоединился Рубен Сомсен, чтобы обсудить токены RGB - биткоин-протокол второго уровня для поддержки систем альтернативных валют и токенов (например, популярных в настоящее время невзаимозаменяемых токенов или NFT).

\noindent
Мы объясняем, что блокчейн Биткоина использовался пользователями для хранения данных с первых дней существования проекта. Первоначально это делалось с помощью бесполезных выходов транзакций, а это означало, что все пользователи Биткоина должны были хранить эти данные локально. Функция под названием `OP_RETURN` позже снизила эту нагрузку. Мы также объясняем, что люди уже давно используют блокчейн Биткоина для размещения систем альтернативных валют и токенов.

Несколько лет назад Сьорс также выступил с презентацией об RGB и более ранних попытках использования блокчейна Биткоина для хранения неденежных сущностей.^[<https://www.youtube.com/watch?v=PgeqT6ruBWU>]
	
#### OpenTimestamps

\EpisodeQR{16}

В этом эпизоде мы обсуждаем OpenTimestamps,^[<https://opentimestamps.org>] проект по ведению отметок времени на основе Биткоина, разработанный консультантом по прикладной криптографии и бывшим участником Bitcoin Core Питером Тоддом. OpenTimestamps использует безопасность блокчейна Биткоина для добавления отметки времени к любому типу данных, что позволяет неопровержимо доказать, что эти данные существовали в определенный момент времени.

Мы объясняем, что практически любой объем данных может быть помечен временной меткой в блокчейне Биткоина с минимальными затратами, потому что OpenTimestamps использует деревья Меркла, криптографический прием для объединения данных в единый компактный хэш. Затем этот хэш включается в биткоин-транзакцию, что делает все данные, объединенные в хеш, такими же неизменяемыми, как и любая другая биткоин-транзакция.

Примерно в то время, когда был записан эпизод, Питер предложил интересную демонстрацию OpenTimestamps, поскольку он доказал, что открытый ключ, используемый Google для подписи вызвавшего разногласия письма Хантеру Байдену, существовал еще в 2016 году.^[<https://github.com /robertdavidgraham/hunter-dkim/tree/main/ots-timestamp>]


Мы также обсуждаем некоторые другие возможности, которые предлагает система временных меток, такая как OpenTimestamps, а также ее ограничения. Наконец, Аарон дает небольшой контекст истории криптографических отметок времени, на которых основывался whitepaper Биткоина.

Мы присвоили исходному тексту этой книги отметку времени, чтобы вы могли убедиться, что черновая версия существовала еще в марте 2022 года:

```
c=86a7cd200acb1812b6b2f8be27c8380ea44c9470
git verify-commit $c
git cat-file -p $c > meta/commit
ots verify meta/commit.ots
```

Приведенный выше сценарий проверки также находится в репозитории исходного кода вместе с файлом временной метки `.ots`, который вам необходим для проверки: <https://btcwip.com/ots>

#### Discreet Log Contracts

\EpisodeQR{53}

В этом выпуске к нам снова присоединился местный эксперт по сайдчейнам и протоколам второго уровня Рубен Сомсен, на этот раз для обсуждения Discreet Log Contracts (DLC).

\noindent
DLC — это тип смарт-контрактов для Биткоина, который впервые предложил Тадж Дрийя, соавтор whitepaper Lightning Network.^[<https://adiabat.github.io/dlc.pdf>] По сути, DLC — это способ делать ставки, но это означает, что в конечном итоге их можно использовать для всех видов финансовых инструментов, включая фьючерсные рынки, страховки и стейблкоины.

В начале выпуска мы обсуждаем то, что можно считать чем-то вроде прото-DLC, а именно вид мультиподписной транзакции для ставок на спорт, когда два участника добавляют нейтральную третью сторону («оракул»), которая, если потребуется, может разрешить ставку в пользу одной или другой стороны. Однако мы объясняем, почему это решение имеет ряд недостатков, таких как сложность его масштабирования.

Далее мы продолжаем объяснять, как DLC решили эти проблемы, используя инструмент, напоминающий каналы оплаты, применяемые в сети Lightning. При такой структуре оракулы просто должны опубликовать криптографически подписанное сообщение об исходе события, которое может быть использовано выигравшим участником пари для создания транзакции вывода из платежного канала.

Наконец, мы объясняем, как первоначальную концепцию DLC можно упростить с помощью подписей адаптера,^[<https://bitcoinops.org/en/topics/adaptor-signatures/>] своего рода «неполной подписи», которую можно сделать полной, используя подписанное сообщение от оракула. С подписями адаптера для DLC больше не требуется отдельная транзакция вывода средств, поскольку победитель может запросить средства напрямую из платежного канала.

\newpage

### Software Releases

#### Bitcoin Core v0.21

\EpisodeQR{24}

В этом эпизоде мы обсуждаем Bitcoin Core 0.21.0, 21-й основной релиз программного клиента Bitcoin Core.^[<https://bitcoinmagazine.com/technical/bitcoin-core-0-21-0-released-whats-new>] Bitcoin Core — старейшая и наиболее важная реализация узла Биткоина, которую часто также считают эталонной реализацией протокола Биткоина.

Руководствуясь примечаниями к выпуску Bitcoin Core 0.21.0, мы обсуждаем наиболее важные изменения в этом выпуске. К ним относятся новая политика мемпула для ретрансляции транзакций, поддержка Tor v3, одноранговые привязки при перезапуске узла, BIP 157 (Neutrino) для легких клиентов, новая тестовая сеть под названием Signet, BIP 339 (ретранслятор wtxid), код Taproot, изменения RPC, включая новый RPC для отправки, ZeroMQ, дескрипторные кошельки, новая система баз данных SQLite и деноминация комиссии в виде сатоши за байт.

Для каждой из новых функций мы обсуждаем, что это за функции, как они изменят использование Биткоина (Core) и — где это уместно — какова конечная цель нововведения. (При разработке Bitcoin Core новые функции часто являются частью более крупного процесса.) Для каждой функции, которую мы обсуждали в предыдущем выпуске _Bitcoin, Explained_, мы также указываем соответствующий номер выпуска.

\newpage
#### Bitcoin Core v22.0

\EpisodeQR{45}

В этом выпуске мы обсуждаем Bitcoin Core 22.0, следующий крупный релиз программного клиента Bitcoin Core.^[<https://bitcoincore.org/en/releases/22.0/>]

\noindent
Первое из обсуждаемых обновлений — поддержка аппаратного кошелька в графическом пользовательском интерфейсе (GUI). Хотя поддержка аппаратного кошелька была развернута в нескольких предыдущих релизах Bitcoin Core, теперь она полностью доступна в графическом интерфейсе. Второе важное обновление — это поддержка Invisible Internet Project (I2P), конфиденциальный слой интернета, наподобие Tor. Также мы кратко коснулись различий между I2P и Tor.

Третье обновление, обсуждаемое в эпизоде — это поддержка Taproot. Хотя логика активации Taproot уже была включена в Bitcoin Core 0.21.1, Bitcoin Core 22.0 — это первый крупный релиз Bitcoin Core, готовый поддерживать Taproot, хотя и с ограниченной функциональностью.

Четвертое обновление, которое мы обсуждаем — это обновление логики testmempoolaccept, которое прокладывает путь к более крупному обновлению ретранслятора пакетов. В будущих релизах это может позволить передавать транзакции по сети Биткоина пакетами, включающими несколько транзакций одновременно.

Кроме того, мы кратко обсуждаем расширение для создания мультиподписных адресов, новую опцию NAT-PMP и многое другое.
\newpage

#### Синхронизация старых биткоин-узлов

\EpisodeQR{55}

Мы обсуждаем исследование, проведенное соучредителем и техническим директором CasaHODL Джеймсоном Лоппом, а также исследование Сьорса по синхронизации старых узлов Биткоина.^[<https://blog.lopp.net/bitcoin-core-performance-evolution/>]

\noindent
Всякий раз, когда новый биткоин-узел подключается к сети, он должен сначала синхронизироваться с остальной частью сети Биткоина: он должен загрузить и проверить всю цепочку блоков до самого последнего блока, чтобы быть в курсе текущей ситуации по владению биткоинами. Однако это может занять некоторое время, и чем дальше, тем больше, поскольку блокчейн продолжает расти. Чтобы компенсировать это и улучшить взаимодействие с пользователем в целом, разработчики Bitcoin Core стремятся повысить производительность кода Bitcoin Core, чтобы новые версии синхронизировались быстрее, чем их предшественники.

In the episode, we outline the performance improvements of Bitcoin Core clients over time, as analyzed most recently in two blog posts by Jameson. We first explain why some very old Bitcoin clients have trouble syncing to the current state of the blockchain at all, pointing out some bugs in this early software, as well as issues relating to dependencies and the challenge of using such old clients today (some of which we covered in chapter @sec:libsecp). We then go on to sum up some of the most important performance improvements that have been included in new Bitcoin Core releases over time.

В этом выпуске мы рассказываем об улучшении производительности клиентов Bitcoin Core с течением времени, что было недавно проанализировано в двух постах в блоге Джеймсона. Сначала мы объясняем, почему у некоторых очень старых биткоин-клиентов вообще возникают проблемы с синхронизацией текущего состояния блокчейна, указав на некоторые ошибки в этом раннем софте, а также проблемы, связанные с зависимостями, и сложности использования сегодня таких старых клиентов (некоторые из них мы рассмотрели в главе @sec:libsecp). Затем мы суммируем некоторые из наиболее важных улучшений производительности, которые были включены с течением времени в новые выпуски Bitcoin Core.

На рисунке на следующей странице показан результат анализа за 2017 год.^[<https://sprovoost.nl/2017/07/22/historical-bitcoin-core-client-performance-c5f16e1f8ccb/>]
\newpage

![IBD on EC2 (~474K blocks, t2.xlarge, 4 cores, 16 GiB, GP2 200 GiB SSD). We explained Assume Valid in chapter @sec:assume.](appendix/performance.svg)

![IBD на EC2 (~474 Кб блоков, t2.xlarge, 4 ядра, 16 Гб, GP2 200 Гб SSD). Мы рассказывали про Assume Valid в главе @sec:assume.](appendix/performance.svg)
\newpage
